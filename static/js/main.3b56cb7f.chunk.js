(this["webpackJsonpregistration-page"]=this["webpackJsonpregistration-page"]||[]).push([[0],{29:function(e,t,n){},32:function(e,t,n){},38:function(e,t,n){},39:function(e,t,n){},40:function(e,t,n){},41:function(e,t,n){},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){},49:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),c=n(20),r=n.n(c),i=(n(29),n(14)),o=n(2),l=n(8),u=n.n(l),j=n(10),b=n(3),d=n(0),O=a.a.createContext(),h=function(e){var t=e.children,n=Object(s.useState)(null),a=Object(b.a)(n,2),c=a[0],r=a[1],i=Object(s.useState)(null),o=Object(b.a)(i,2),l=o[0],u=o[1],j=Object(s.useState)(!1),h=Object(b.a)(j,2),m={user:c,setUser:r,isLoggedIn:h[0],setIsLoggedIn:h[1],userDetails:l,setUserDetails:u};return Object(d.jsx)(O.Provider,{value:m,children:t})},m=(n(32),function(e){var t=e.title,n=e.to,s=Object(o.g)();return Object(d.jsx)("button",{className:"button",onClick:function(){return s.push(n)},children:t})}),p=(n(38),function(e){var t=e.children;return Object(d.jsx)("main",{className:"container",children:t})}),f=(n(39),function(){var e=Object(s.useContext)(O),t=e.isLoggedIn,n=e.setIsLoggedIn,a=e.setUser,c=function(){var e=Object(j.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("http://localhost:3000/auth/logout",{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}).then((function(e){return e.json()})).then((function(e){return e})).catch((function(e){return console.log(e)}));case 2:e.sent.ok&&(n(!1),a(null));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return Object(d.jsx)(p,{children:Object(d.jsxs)("div",{className:"home",children:[Object(d.jsxs)("div",{className:"home__container",children:[Object(d.jsx)("h2",{className:"home__container__title",children:t?"Already signed in":"Sign in"}),t?Object(d.jsx)("button",{className:"button",onClick:function(){return c()},children:"log out"}):Object(d.jsx)(m,{title:"sign in",to:"login"})]}),Object(d.jsxs)("div",{className:"home__container",children:[Object(d.jsx)("h2",{className:"home__container__title",children:"Don't have an account?"}),Object(d.jsx)(m,{title:"register",to:"register"})]})]})})}),g=(n(40),function(e){var t=e.children;return Object(d.jsx)("div",{className:"content-container",children:t})}),x=n(13),v=n(12),N=n(22),y=n(23),w="https://pharmacy-rest.herokuapp.com/",_=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"GET",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{"Content-Type":"application/json"},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"include",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Object(N.a)(this,e),this.method=t,this.headers=n,this.credentials=s,this.body=a}return Object(y.a)(e,[{key:"getOptions",value:function(){return{method:this.method,headers:this.headers,credentials:this.credentials,body:this.body}}}]),e}(),k=new _,S=function(){var e=Object(s.useState)(null),t=Object(b.a)(e,2),n=t[0],a=t[1],c=Object(s.useState)(null),r=Object(b.a)(c,2),i=r[0],o=r[1],l=Object(s.useState)(k.getOptions()),d=Object(b.a)(l,2),O=d[0],h=d[1],m=Object(s.useState)(null),p=Object(b.a)(m,2),f=p[0],g=p[1],x=Object(s.useState)(!1),v=Object(b.a)(x,2),N=v[0],y=v[1],w=Object(s.useRef)({});Object(s.useEffect)((function(){i&&function(){var e=Object(j.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(y(!0),!w.current[i]){e.next=3;break}return e.abrupt("return");case 3:return e.prev=3,e.next=6,fetch(i,O);case 6:return t=e.sent,e.next=9,t.json();case 9:n=e.sent,console.log("DATA",n),n.ok?(w.current[i]=n,a(n)):g(n.message),e.next=17;break;case 14:e.prev=14,e.t0=e.catch(3),g(e.t0.message);case 17:y(!1);case 18:case"end":return e.stop()}}),e,null,[[3,14]])})));return function(){return e.apply(this,arguments)}}()()}),[i,O]);return[{data:n,isLoading:N,error:f},function(e,t){o(e),t&&h(t)}]},C=function(e,t,n,s){var a={};return[function(e){var t="";return e?/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,4}$/i.test(e)||(t="Invalid email address"):t="Insert email",{message:t,type:"email"}}(e),function(e){var t="";return e||(t="Insert password"),{message:t,type:"password"}}(t),"register"===s?function(e,t){var n="";return t?e!==t&&(n="Passwords must be the same"):n="Repeat password",{message:n,type:"repeatPassword"}}(t,n):null].forEach((function(e){return e&&e.message?a[e.type]=e.message:null})),a},I=(n(41),function(e){var t=e.message;return Object(d.jsx)("div",{className:"alert",children:Object(d.jsx)("p",{className:"alert__message",children:t})})}),L=(n(42),function(e){var t=e.handleOnChange,n=e.value,s=e.type,a=e.name,c=e.title,r=e.warning,i=Boolean(r)?"input--warning":"";return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)("div",{className:"input__container",children:[Object(d.jsx)("label",{className:"label",children:c||a}),Object(d.jsx)("input",{className:"input ".concat(i),onChange:function(e){return t(e)},value:n||"",type:s,name:a})]}),Boolean(r)&&Object(d.jsx)(I,{message:r})]})}),P=(n(43),function(e){var t=e.type,n=e.callback,a=Object(s.useState)({}),c=Object(b.a)(a,2),r=c[0],i=c[1],l=Object(s.useState)({}),h=Object(b.a)(l,2),m=h[0],p=h[1],f=S(),g=Object(b.a)(f,2),N=g[0],y=N.data,k=(N.isLoading,N.error),P=g[1],E=Object(o.h)(),A=Object(s.useContext)(O),B=A.setUser,F=A.setIsLoggedIn,D=function(e){e.preventDefault();var t=e.target,n=t.value,s=t.name;i((function(e){return Object(v.a)(Object(v.a)({},e),{},Object(x.a)({},s,n))}))},T=function(){var e=Object(j.a)(u.a.mark((function e(n){var s,a,c,i,o,l,j;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.preventDefault(),s=r.email,a=r.password,c=r.repeatPassword,Boolean(Object.keys(r).length)){e.next=5;break}return p({message:"Fill up form before submit"}),e.abrupt("return");case 5:if(i=C(s,a,c,t),!Boolean(Object.keys(i).length)){e.next=9;break}return p(i),e.abrupt("return");case 9:o=JSON.stringify(r),l=new _("POST",void 0,void 0,o),j="register"===t?"".concat(w,"user").concat(E.pathname):"".concat(w,"auth").concat(E.pathname),P(j,l);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return console.log(y),Object(s.useEffect)((function(){(null===y||void 0===y?void 0:y.user)&&(B(y.user),F(!0)),n&&(null===y||void 0===y?void 0:y.ok)&&n(!0),k&&p({message:k})}),[y,n,k,F,B]),Object(d.jsxs)(d.Fragment,{children:[Object(d.jsxs)("form",{className:"form",onSubmit:function(e){return T(e)},noValidate:!0,children:[Object(d.jsx)(L,{handleOnChange:D,value:r.email||"",type:"email",name:"email",warning:m.email||""}),Object(d.jsx)(L,{handleOnChange:D,value:r.password||"",type:"password",name:"password",warning:m.password||""}),"register"===t?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)(L,{handleOnChange:D,value:r.repeatPassword||"",type:"password",name:"repeatPassword",title:"repeat password",warning:m.repeatPassword||""}),Object(d.jsx)(L,{handleOnChange:D,value:r.name||"",type:"text",name:"name"}),Object(d.jsx)(L,{handleOnChange:D,value:r.lastName||"",type:"text",name:"lastName",title:"last name"})]}):null,Object(d.jsx)("button",{className:"form__button",type:"submit",children:"register"===t?"Register":"Log In"})]}),Boolean(m.message)&&Object(d.jsx)(I,{message:m.message})]})}),E=(n(44),function(){var e=Object(s.useContext)(O).isLoggedIn;return Object(d.jsxs)(p,{children:[e&&Object(d.jsx)(o.a,{to:"/profile"}),Object(d.jsxs)(g,{children:[Object(d.jsx)("h1",{children:"Log in"}),Object(d.jsx)(P,{})]}),Object(d.jsx)(m,{title:"home",to:"/"})]})}),A=(n(45),function(){var e=Object(s.useContext)(O).user;return Object(d.jsxs)("nav",{className:"nav",children:[Object(d.jsx)("div",{className:"nav__menu",children:Object(d.jsx)("i",{className:"fas fa-bars"})}),Object(d.jsxs)("div",{className:"nav__user",children:[Object(d.jsx)("p",{children:e?"Logged as ".concat(e.name||e.email):"No user logged in"}),Object(d.jsx)(i.b,{to:"/profile",children:Object(d.jsx)("i",{className:"fas fa-user"})})]})]})}),B=n(24),F=function(e){var t=e.component,n=Object(B.a)(e,["component"]),a=Object(s.useContext)(O).isLoggedIn;return Object(d.jsx)(o.b,{render:function(){return a?Object(d.jsx)(t,Object(v.a)({},n)):Object(d.jsx)(o.a,{to:"/login"})}})},D=(n(46),function(){var e=Object(s.useState)(null),t=Object(b.a)(e,2),n=t[0],a=t[1],c=Object(o.h)(),r="".concat(w,"user").concat(c.pathname),i=S(),l=Object(b.a)(i,2),u=l[0],j=u.data,O=u.error,h=l[1];return Object(s.useEffect)((function(){O||(h(r),(null===j||void 0===j?void 0:j.ok)&&a(j.user))}),[O,h,r,j]),Object(d.jsxs)(p,{children:[Object(d.jsxs)("div",{className:"profile",children:[O,n&&Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("h1",{className:"profile__title",children:"Profile"}),Object(d.jsxs)("p",{className:"profile__user",children:[n.name||"NO"," ",n.lastName||"NAME"]}),Object(d.jsx)("div",{className:"profile__avatar",children:Object(d.jsx)("div",{className:"profile__role",children:n.role[0]})}),Object(d.jsx)("p",{children:n.email})]})]}),Object(d.jsx)(m,{title:"home",to:"/"})]})}),T=(n(47),function(){return Object(d.jsx)("div",{className:"footer",children:Object(d.jsx)("p",{children:"By Piotr"})})}),U=(n(48),function(){var e=Object(s.useState)(!1),t=Object(b.a)(e,2),n=t[0],a=t[1];return Object(d.jsxs)(p,{children:[Object(d.jsx)(g,{children:n?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("h2",{children:"Hurray you registered successfully"}),Object(d.jsx)(m,{title:"log in",to:"/login"})]}):Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("h1",{children:"Sign Up"}),Object(d.jsx)(P,{type:"register",callback:a})]})}),Object(d.jsx)(m,{title:"home",to:"/"})]})});var J=function(){return Object(d.jsxs)(h,{children:[Object(d.jsxs)(i.a,{basename:"/registration-panel",children:[Object(d.jsx)(A,{}),Object(d.jsxs)(o.d,{children:[Object(d.jsx)(o.b,{exact:!0,path:"/",component:f}),Object(d.jsx)(o.b,{path:"/login",component:E}),Object(d.jsx)(o.b,{path:"/register",component:U}),Object(d.jsx)(F,{path:"/profile",component:D})]})]}),Object(d.jsx)(T,{})]})};r.a.render(Object(d.jsx)(a.a.StrictMode,{children:Object(d.jsx)(J,{})}),document.getElementById("root"))}},[[49,1,2]]]);
//# sourceMappingURL=main.3b56cb7f.chunk.js.map